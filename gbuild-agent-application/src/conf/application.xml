<application>

  <load-on-start>
    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgent</role>
      <role-hint>build-executor</role-hint>
    </component>
    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgent</role>
      <role-hint>build-producer</role-hint>
    </component>
    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgent</role>
      <role-hint>build-results</role-hint>
    </component>
  </load-on-start>

  <resources>
    <jar-repository>${plexus.home}/lib</jar-repository>
  </resources>

  <components>
    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgent</role>
      <role-hint>build-executor</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.ContinuumBuildAgent</implementation>
      <requirements>
        <requirement>
          <role>org.apache.geronimo.gbuild.agent.BuildAgentExtentionManager</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.continuum.buildcontroller.BuildController</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.continuum.configuration.ConfigurationService</role>
        </requirement>
      </requirements>
      <configuration>
        <contributor>Unknown</contributor>
        <admin-address>scm@geronimo.apache.org</admin-address>
        <coordinator-url>tcp://ci.gbuild.org:6161</coordinator-url>
        <build-task-queue>BUILD.TASKS</build-task-queue>
        <build-results-topic>BUILD.RESULTS</build-results-topic>
        <working-directory>${plexus.home}/agent/work</working-directory>
        <build-output-directory>${plexus.home}/agent/output</build-output-directory>
      </configuration>
    </component>

    <component>
      <role>org.apache.maven.continuum.store.ContinuumStore</role>
      <role-hint>agent-store</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.ThreadContextContinuumStore</implementation>
    </component>

    <component>
      <role>org.apache.maven.continuum.notification.ContinuumNotificationDispatcher</role>
      <!--<role-hint>agent-notifier</role-hint>-->
      <implementation>org.apache.geronimo.gbuild.agent.MockContinuumNotificationDispatcher</implementation>
    </component>

    <!--
    | Build Producer
    -->
    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgent</role>
      <role-hint>build-producer</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.PropertiesBuildTaskProducer</implementation>
      <configuration>
        <coordinator-url>tcp://ci.gbuild.org:6161</coordinator-url>
        <build-task-queue>BUILD.TASKS</build-task-queue>
        <include-prefix>include.</include-prefix>
        <header-prefix>header.</header-prefix>
        <watch-directory>${plexus.home}/tasks</watch-directory>
        <poll-interval>10000</poll-interval>
      </configuration>
    </component>

    <!--
    | Build Results
    -->
    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgent</role>
      <role-hint>build-results</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.BuildResultsContinuumAgent</implementation>
      <requirements>
        <requirement>
          <role>org.apache.geronimo.gbuild.agent.BuildResultsExtentionManager</role>
        </requirement>
      </requirements>
      <configuration>
        <coordinator-url>tcp://ci.gbuild.org:6161</coordinator-url>
        <build-results-topic>BUILD.RESULTS</build-results-topic>
      </configuration>
    </component>

    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildResultsExtention</role>
      <role-hint>write-include-file</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.WriteIncludeFileExtention</implementation>
      <configuration>
        <include-pattern>^include\.</include-pattern>
        <file-extention>.properties</file-extention>
        <results-directory>${plexus.home}/results</results-directory>
        <use-header>project.name</use-header>
        <date-format>yyyy-MM-dd</date-format>
      </configuration>
    </component>

    <!--
    | Logger manager
    -->
    <component>
      <role>org.codehaus.plexus.logging.LoggerManager</role>
      <implementation>org.codehaus.plexus.logging.log4j.Log4JLoggerManager</implementation>
      <lifecycle-handler>basic</lifecycle-handler>

      <configuration>
        <threshold>DEBUG</threshold>
        <default-appender>console,rolling</default-appender>
        <appenders>
          <appender>
            <id>console</id>
            <threshold>DEBUG</threshold>
            <type>org.apache.log4j.ConsoleAppender</type>
            <conversion-pattern>%d [%t] %-5p %-30c{1} - %m%n</conversion-pattern>
          </appender>

          <appender>
            <id>rolling</id>
            <threshold>DEBUG</threshold>
            <type>org.apache.log4j.RollingFileAppender</type>
            <conversion-pattern>%-4r [%t] %-5p %c %x - %m%n</conversion-pattern>

            <properties>
              <property>
                <name>file</name>
                <value>${plexus.home}/logs/gbuild-agent.log</value>
              </property>
              <property>
                <name>append</name>
                <value>true</value>
              </property>
              <property>
                <name>maxBackupIndex</name>
                <value>10</value>
              </property>
              <property>
                <name>maxFileSize</name>
                <value>100KB</value>
              </property>
            </properties>
          </appender>
        </appenders>
        <levels>
          <!--<level>-->
            <!--<hierarchy>org.codehaus.plexus.velocity</hierarchy>-->
            <!--<level>WARN</level>-->
          <!--</level>-->
        </levels>
      </configuration>
    </component>
  </components>

</application>
