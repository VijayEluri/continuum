<application>

  <load-on-start>
    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgent</role>
      <role-hint>build-executor</role-hint>
    </component>
<!--
    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgent</role>
      <role-hint>build-producer</role-hint>
    </component>
    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgent</role>
      <role-hint>build-results</role-hint>
    </component>
    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgent</role>
      <role-hint>ping-monitor</role-hint>
    </component>
-->
  </load-on-start>

  <resources>
    <jar-repository>${plexus.home}/lib</jar-repository>
  </resources>

  <components>
    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgent</role>
      <role-hint>build-executor</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.ContinuumBuildAgent</implementation>
      <requirements>
        <requirement>
          <role>org.apache.geronimo.gbuild.agent.BuildAgentExtentionManager</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.continuum.buildcontroller.BuildController</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.continuum.configuration.ConfigurationService</role>
        </requirement>
      </requirements>
      <configuration>
        <contributor>Unknown</contributor>
        <admin-address>scm@geronimo.apache.org</admin-address>
        <coordinator-url>tcp://ci.gbuild.org:16161</coordinator-url>
        <build-task-queue>BUILD.TASKS</build-task-queue>
        <build-results-topic>BUILD.RESULTS</build-results-topic>
        <working-directory>${plexus.home}/agent/work</working-directory>
        <build-output-directory>${plexus.home}/agent/output</build-output-directory>
      </configuration>
    </component>

    <component>
      <role>org.apache.maven.continuum.store.ContinuumStore</role>
      <role-hint>agent-store</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.ThreadContextContinuumStore</implementation>
    </component>

    <component>
      <role>org.apache.maven.continuum.notification.ContinuumNotificationDispatcher</role>
      <!--<role-hint>agent-notifier</role-hint>-->
      <implementation>org.apache.geronimo.gbuild.agent.MockContinuumNotificationDispatcher</implementation>
    </component>

    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgentExtention</role>
      <role-hint>file-include</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.FileIncludeExtention</implementation>
      <requirements>
        <requirement>
          <role>org.apache.maven.continuum.configuration.ConfigurationService</role>
        </requirement>
      </requirements>
      <configuration>
        <pattern>^include.*</pattern>
      </configuration>
    </component>

    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgentExtention</role>
      <role-hint>general-headers</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.HeaderIncludeExtention</implementation>
      <configuration>
        <pattern>^(project|build|header).*</pattern>
      </configuration>
    </component>


    <!--
    | Build Producer
    -->
    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgent</role>
      <role-hint>build-producer</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.PropertiesBuildTaskProducer</implementation>
      <configuration>
        <coordinator-url>tcp://ci.gbuild.org:16161</coordinator-url>
        <build-task-queue>BUILD.TASKS</build-task-queue>
        <include-prefix>include.</include-prefix>
        <header-prefix>header.</header-prefix>
        <watch-directory>${plexus.home}/tasks</watch-directory>
        <poll-interval>10000</poll-interval>
      </configuration>
    </component>

    <!--
    | Build Results
    -->
    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgent</role>
      <role-hint>build-results</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.BuildResultsContinuumAgent</implementation>
      <requirements>
        <requirement>
          <role>org.apache.geronimo.gbuild.agent.BuildResultsExtentionManager</role>
        </requirement>
      </requirements>
      <configuration>
        <coordinator-url>tcp://ci.gbuild.org:16161</coordinator-url>
        <build-results-topic>BUILD.RESULTS</build-results-topic>
      </configuration>
    </component>

    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildResultsExtention</role>
      <role-hint>write-include-file</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.WriteIncludeFileExtention</implementation>
      <configuration>
        <include-pattern>^include.*</include-pattern>
        <file-extention>.properties</file-extention>
        <results-directory>${plexus.home}/results</results-directory>
        <use-header>build.name</use-header>
        <date-format>yyyy-MM-dd</date-format>
      </configuration>
    </component>

    <!--
    | Logger manager
    -->
    <component>
      <role>org.codehaus.plexus.logging.LoggerManager</role>
      <implementation>org.codehaus.plexus.logging.log4j.Log4JLoggerManager</implementation>
      <lifecycle-handler>basic</lifecycle-handler>

      <configuration>
        <threshold>DEBUG</threshold>
        <default-appender>console,rolling</default-appender>
        <appenders>
          <appender>
            <id>console</id>
            <threshold>DEBUG</threshold>
            <type>org.apache.log4j.ConsoleAppender</type>
            <conversion-pattern>%d [%t] %-5p %-30c{1} - %m%n</conversion-pattern>
          </appender>

          <appender>
            <id>rolling</id>
            <threshold>DEBUG</threshold>
            <type>org.apache.log4j.RollingFileAppender</type>
            <conversion-pattern>%-4r [%t] %-5p %c %x - %m%n</conversion-pattern>

            <properties>
              <property>
                <name>file</name>
                <value>${plexus.home}/logs/gbuild-agent.log</value>
              </property>
              <property>
                <name>append</name>
                <value>true</value>
              </property>
              <property>
                <name>maxBackupIndex</name>
                <value>10</value>
              </property>
              <property>
                <name>maxFileSize</name>
                <value>100KB</value>
              </property>
            </properties>
          </appender>
        </appenders>
        <levels>
          <level>
            <hierarchy>org.apache.geronimo.gbuild.agent.BuildAgentExtention:file-include</hierarchy>
            <level>INFO</level>
          </level>
          <level>
            <hierarchy>org.apache.geronimo.gbuild.agent.BuildAgentExtention:general-headers</hierarchy>
            <level>INFO</level>
          </level>
          <level>
            <hierarchy>org.apache.geronimo.gbuild.agent.BuildResultsExtention:write-include-file</hierarchy>
            <level>INFO</level>
          </level>
          <level>
            <hierarchy>org.apache.geronimo.gbuild.agent.BuildAgentExtention:file-include</hierarchy>
            <level>INFO</level>
          </level>
          <level>
            <hierarchy>org.activemq</hierarchy>
            <level>WARN</level>
          </level>

            <!--There was no such logger 'org.apache.maven.continuum.configuration.ConfigurationService' 8918836.-->
            <!--There was no such logger 'org.apache.maven.continuum.execution.maven.m2.MavenBuilderHelper' 8918836.-->
            <!--There was no such logger 'org.apache.geronimo.gbuild.agent.BuildResultsExtentionManager' 8918836.-->
            <!--There was no such logger 'org.apache.maven.continuum.execution.ContinuumBuildExecutor:shell' 8918836.-->
            <!--There was no such logger 'org.codehaus.plexus.action.Action:checkout-project' 8918836.-->
            <!--There was no such logger 'org.apache.maven.continuum.buildcontroller.BuildController' 8918836.-->
            <!--There was no such logger 'org.apache.maven.continuum.scm.ContinuumScm' 8918836.-->
            <!--There was no such logger 'org.apache.maven.settings.MavenSettingsBuilder' 8918836.-->
            <!--There was no such logger 'org.apache.geronimo.gbuild.agent.BuildResultsExtention:write-include-file' 8918836.-->
            <!--There was no such logger 'org.apache.maven.continuum.utils.WorkingDirectoryService' 8918836.-->
            <!--There was no such logger 'org.apache.maven.artifact.resolver.ArtifactResolver' 8918836.-->
            <!--There was no such logger 'org.apache.geronimo.gbuild.agent.BuildAgentExtentionManager' 8918836.-->
            <!--There was no such logger 'org.apache.geronimo.gbuild.agent.BuildAgent:build-producer' 8918836.-->
            <!--There was no such logger 'org.codehaus.plexus.action.ActionManager' 8918836.-->
            <!--There was no such logger 'org.apache.geronimo.gbuild.agent.BuildAgent:build-results' 8918836.-->
            <!--There was no such logger 'org.apache.maven.continuum.execution.ContinuumBuildExecutor:maven2' 8918836.-->
            <!--There was no such logger 'org.apache.maven.project.interpolation.ModelInterpolator' 8918836.-->
            <!--There was no such logger 'org.apache.maven.continuum.execution.manager.BuildExecutorManager' 8918836.-->
            <!--There was no such logger 'org.apache.maven.continuum.utils.shell.ShellCommandHelper' 8918836.-->
            <!--There was no such logger 'org.apache.maven.continuum.execution.ContinuumBuildExecutor:maven-1' 8918836.-->
            <!--There was no such logger 'org.apache.geronimo.gbuild.agent.BuildAgentExtention:file-include' 8918836.-->
            <!--There was no such logger 'org.apache.maven.continuum.execution.maven.m1.MavenOneMetadataHelper' 8918836.-->
            <!--There was no such logger 'org.codehaus.plexus.action.Action:execute-builder' 8918836.-->
            <!--There was no such logger 'org.apache.maven.artifact.repository.metadata.RepositoryMetadataManager' 8918836.-->
            <!--There was no such logger 'org.apache.maven.artifact.transform.ArtifactTransformation:release' 8918836.-->
            <!--There was no such logger 'org.apache.maven.project.MavenProjectBuilder' 8918836.-->
            <!--There was no such logger 'org.apache.maven.artifact.transform.ArtifactTransformation:snapshot' 8918836.-->
            <!--There was no such logger 'org.apache.maven.scm.manager.ScmManager' 8918836.-->
            <!--There was no such logger 'org.apache.maven.artifact.manager.WagonManager' 8918836.-->
            <!--There was no such logger 'org.codehaus.plexus.action.Action:update-project-from-working-directory' 8918836.-->
            <!--There was no such logger 'org.codehaus.plexus.action.Action:check-working-directory' 8918836.-->
            <!--There was no such logger 'org.apache.maven.artifact.transform.ArtifactTransformation:latest' 8918836.-->
          <!--<level>-->
            <!--<hierarchy>org.codehaus.plexus.velocity</hierarchy>-->
            <!--<level>WARN</level>-->
          <!--</level>-->
        </levels>
      </configuration>
    </component>
  </components>

</application>
